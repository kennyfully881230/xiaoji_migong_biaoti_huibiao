<!DOCTYPE html>
//Actually it's Chinese
<html lang="zh-CN">

<head><!-- The appropriate data will be generated with JavaScript. 将使用 JavaScript 生成适当的数据。 --></head>

<body><!-- A canvas will be generated with JavaScript. 将使用 JavaScript 生成 <canvas> --></body>

<script>
  // Generates the appropriate data inside the <head> and <body> tags.
  // 在 <head> 和 <body> 标签内生成适当的数据。
  'use strict';
  (() => {
    // SECURITY FIX
    const head = document.querySelector('head');
    const body = document.querySelector('body');

    // -- Create and append elements to <head> --
    const metaCharset = document.createElement('meta');
    metaCharset.setAttribute('charset', 'UTF-8');
    head.appendChild(metaCharset);

    const metaCompatible = document.createElement('meta');
    metaCompatible.setAttribute('http-equiv', 'X-UA-Compatible');
    metaCompatible.setAttribute('content', 'IE=edge'); // Added content for correctness
    head.appendChild(metaCompatible);
    
    // SECURITY FIX
    const metaCsp = document.createElement('meta');
    metaCsp.setAttribute('http-equiv', 'Content-Security-Policy');
    metaCsp.setAttribute('content', "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; object-src 'none'; frame-ancestors 'none';");
    head.appendChild(metaCsp);

    const metaViewport = document.createElement('meta');
    metaViewport.setAttribute('name', 'viewport');
    metaViewport.setAttribute('content', 'viewport-fit=cover,width=device-width,initial-scale=1,maximum-scale=1');
    head.appendChild(metaViewport);

    const linkIcon = document.createElement('link');
    linkIcon.className = 'app-icon';
    linkIcon.setAttribute('rel', 'icon');
    linkIcon.setAttribute('href', '#'); // Placeholder
    head.appendChild(linkIcon);

    const style = document.createElement('style');
    style.textContent = `*{box-sizing:border-box;color:#EEEEEE40;font-family:Arial,Helvetica,sans-serif;margin:0;padding:0;touch-action:none;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;user-select:none}body{align-items:center;background-color:#000010;display:flex;flex-direction:column;height:100dvh;justify-content:center} canvas{background-color:#EEEEEE;image-rendering:pixelated;}@media(orientation:landscape){canvas{height:100%}}@media(orientation:portrait){canvas{width:100%}}`;
    head.appendChild(style);

    const title = document.createElement('title');
    title.textContent = '小鸡迷宫标题徽标';
    head.appendChild(title);
    
    // -- <body> --
    const canvasEl = document.createElement('canvas');
    canvasEl.setAttribute('width', '320px');
    canvasEl.setAttribute('height', '320px');
    body.insertAdjacentElement('afterbegin', canvasEl);
  })();

  const canvas = document.querySelector('canvas');
  // SECURITY FIX
  if (!canvas) {
    throw new Error('Canvas element not found in the DOM.');
  }
  const ctx = canvas.getContext('2d');
  if (!ctx) {
    throw new Error('2D context is not supported or canvas failed to initialize.');
  }

  const pixelSteps = [0, 2, 4, 6, 8, 6, 4, 2, 0]; // Manual easing

  const timers = {
    timer60: 0,
    timer60max: 59,
  }

  class DigiPointer {
    constructor() {
      this.pos = {
        isTouching: false,
        dx: null,
        dy: null
      }
    }

    render() {
      // No security issue here, but a logical redundancy was present.
      // The check is just to ensure dx/dy are not null.
      if (this.pos.dx !== null && this.pos.dy !== null) {
        ctx.fillStyle = 'rgba(0,0,0, 0.5)'
        ctx.fillRect(this.pos.dx, this.pos.dy, 1, 1)
      }
    }
  }

  class ColorModule {
    constructor(options) {
      this.id = options?.id ?? 0
      this.r = options?.r ?? 0
      this.g = options?.g ?? 0
      this.b = options?.b ?? 0
    }

    render() {
      const pathColorLabel = new Path2D(`m ${this.id % 2 * 160 + 5},141 v 2 h -4 v 2 h 2 v 2 h -2 v 12 h 2 v -2 h 2 v -2 h -2 v -2 h 2 v -2 h -2 v -2 h 2 v 2 h 2 v -2 h 4 v 4 h 2 v -6 h 4 v 2 h -2 v 6 h 2 v -2 h 2 v -8 h -4 v -2 h 4 v -2 h -8 v 2 h 2 v 2 h -2 v 2 h -2 v -2 h 2 v -2 h -4 v -2 z m 12,14 v 4 h 2 v -4 z m -2,0 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,-4 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m 0,-2 v -2 h -2 v 2 z m 0,-2 h 2 v -2 h -2 z m 18,-12 v 2 h 6 v 2 h -6 v -2 h -2 v 2 h -2 v 2 h 2 v 12 h 16 v -4 h -2 v 2 h -12 v -4 h 12 v -8 h -4 v -2 h 2 v -2 z m -20,4 h 2 v 2 h -2 z m 20,2 h 4 v 4 h -4 z m 6,0 h 4 v 4 h -4 z`)
      const pathNumber1 = new Path2D(`m 48,142 v 2 h -2 v 2 h -2 v 2 h 4 v 6 h -4 v 4 h 12 v -4 h -4 v -12 z`)
      const pathNumber2 = new Path2D(`m 206,142 v 2 h -2 v 4 2 h 4 v -2 h 2 v 2 h -1 -1 v 1 1 h -2 v 2 h -2 v 4 h 12 v -4 h -4 v -2 h 2 v -1 -1 h 2 v -2 -4 h -2 v -2 z`)

      ctx.fillStyle = `rgb(38,50,56)` // gray
      ctx.fill(pathColorLabel)
      this.id === 0 ? ctx.fill(pathNumber1) : ctx.fill(pathNumber2)
      ctx.fillRect(this.id % 2 * 160 + 62, 142, 16, 16) // current outline
      ctx.fillStyle = `rgb(${this.r},${this.g},${this.b})`
      ctx.fillRect(this.id % 2 * 160 + 64, 144, 12, 12) // current color
    }
  }

  // todo: get rid of hardcoded color values
  class ColorSlider {
    constructor(options) {
      this.id = options?.id ?? 0 // id should be between 0 and 5
      this.id < 3 ? this.colorModuleSet = 0 : this.colorModuleSet = 1
      this.dx = options?.dx ?? 0
      this.dy = options?.dy ?? 0
      this.dw = options?.dw ?? 50 // this only applies to the slider bar
      this.dh = options?.dh ?? 10 // this only applies to the slider bar
      this.STATIC_PATH_R = new Path2D('m 6,2 v 2 h -2 v 2 12 h 4 v -4 h 2 v 2 h 2 v 2 h 4 v -2 -2 h -2 v -2 h 2 v -6 -2 h -2 v -2 z m 2,4 h 4 v 4 h -4 z')
      this.STATIC_PATH_G = new Path2D('m 6,2 v 2 h -2 v 12 h 2 v 2 h 8 v -2 h 2 v -4 -4 h -6 v 4 h 2 v 2 h -4 v -8 h 8 v -4 z')
      this.STATIC_PATH_B = new Path2D('m 4,2 v 4 12 h 4 6 v -2 h 2 v -2 -2 h -2 v -2 h 2 v -6 h -2 v -2 z m 4,4 h 4 v 2 h -4 z m 0,6 h 4 v 2 h -4 z')
      this.STATIC_PATH_SLIDER = new Path2D('m 2,0 v 2 h -2 v 16 h 2 v 2 h 2 v -2 h 2 v -16 h -2 v -2 z')
    }

    render(options) {
      const moduleSet = options.colorModules[this.colorModuleSet]
      const sliderType = moduleSet[this.id % 3 === 0 ? 'r' : this.id % 3 === 1 ? 'g' : 'b']

      ctx.save()
      ctx.translate(Math.floor(this.id / 3) % 2 * 160, this.id % 3 * 40 + 180)

      if (this.id % 3 === 0) {
        ctx.fillStyle = 'rgb(191,54,12)'
        ctx.fill(this.STATIC_PATH_R)
      } else if (this.id % 3 === 1) {
        ctx.fillStyle = 'rgb(51,105,30)'
        ctx.fill(this.STATIC_PATH_G)
      } else {
        ctx.fillStyle = 'rgb(1,87,155)'
        ctx.fill(this.STATIC_PATH_B)
      }

      ctx.restore()
      ctx.fillStyle = `rgb(${moduleSet.r},${moduleSet.g},${moduleSet.b})`
      ctx.fillRect(Math.floor(this.id / 3) % 2 * 160 + 20, this.id % 3 * 40 + 188, 100, 4) // slider bars

      ctx.save()
      ctx.translate(Math.floor(this.id / 3) % 2 * 160 + 20 + Math.floor(sliderType / 255 * 99) - 2, this.id % 3 * 40 + 180)

      ctx.fillStyle = 'rgb(38,50,56)'
      ctx.fill(this.STATIC_PATH_SLIDER)
      ctx.fillStyle = 'rgb(255,255,255)'
      ctx.fillRect(2, 2, 2, 16)
      ctx.restore()
    }

    update(options) {
      const moduleSet = options.colorModules[this.colorModuleSet]
      const digiPointerPOS = digiPointer.pos
      const hitBoxDX = Math.floor(this.id / 3) % 2 * 160 + 20
      const hitBoxDY = this.id % 3 * 40 + 180
      const hitBoxDW = 100
      const hitBoxDH = 20

      if (
        digiPointer.pos.dx >= hitBoxDX &&
        digiPointer.pos.dx < hitBoxDX + hitBoxDW &&
        digiPointer.pos.dy >= hitBoxDY &&
        digiPointer.pos.dy < hitBoxDY + hitBoxDH &&
        digiPointer.pos.isTouching
      ) {
        // posX - hitBoxX = normalize
        ctx.fillStyle = 'rgba(0,0,0,0.25)'
        ctx.fillRect(Math.floor(this.id / 3) % 2 * 160 + 20, this.id % 3 * 40 + 180, 100, 20) // slider bars
        const rawValue = (digiPointerPOS.dx - hitBoxDX) / 99 * 255;
        // SECURITY FIX
        const clampedValue = Math.round(Math.max(0, Math.min(rawValue, 255)));
        moduleSet[this.id % 3 === 0 ? 'r' : this.id % 3 === 1 ? 'g' : 'b'] = clampedValue;
      }
    }
  }

  // The color test and how to use message
  class HowToUseMsg {
    constructor() {
      // 颜色测试
      this.STATIC_PATH_COLOR_TEST_ZH = new Path2D('m 5,1 v 2 h -4 v 2 h 2 v 2 h -2 v 12 h 2 v -2 h 2 v -2 h -2 v -2 h 2 v -2 h -2 v -2 h 2 v 2 h 2 v -2 h 4 v 4 h 2 v -6 h 4 v 2 h -2 v 6 h 2 v -2 h 2 v -8 h -4 v -2 h 4 v -2 h -8 v 2 h 2 v 2 h -2 v 2 h -2 v -2 h 2 v -2 h -4 v -2 z m 12,14 v 4 h 2 v -4 z m -2,0 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,-4 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m 0,-2 v -2 h -2 v 2 z m 0,-2 h 2 v -2 h -2 z m 18,-12 v 2 h 6 v 2 h -6 v -2 h -2 v 2 h -2 v 2 h 2 v 12 h 16 v -4 h -2 v 2 h -12 v -4 h 12 v -8 h -4 v -2 h 2 v -2 z m 16,0 v 2 h 2 v -2 z m 2,2 v 2 h 2 v -2 z m 4,-2 v 12 h 2 v -10 h 4 v 6 h -2 v 6 h 2 v -2 h 2 v -12 z m 6,14 v 4 h 2 v -4 z m -2,0 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m 8,-16 v 18 h 2 v -18 z m 4,0 v 2 h 2 v -2 z m 2,2 v 2 h 2 v -2 z m 10,-2 v 4 h -6 v 2 h 6 v 2 h -6 v 2 h 2 v 6 h -2 v 2 h 6 v -2 h -2 v -6 h 4 v -4 h 4 v -6 h -2 v 4 h -2 v -4 z m 2,10 v 6 h 2 v -6 z m 2,6 v 2 h 2 v -2 z m -10,0 v -2 h -2 v -8 h -4 v 2 h 2 v 10 h 2 v -2 z m -62,-12 h 2 v 2 h -2 z m 20,2 h 4 v 4 h -4 z m 6,0 h 4 v 4 h -4 z m 10,0 v 2 h 2 v -2 z m 2,2 v 2 h 2 v -2 z m 0,6 v 2 h 2 v -2 z m 0,2 h -2 v 2 h 2 z')

      // 作者：肯尼·富利
      this.STATIC_PATH_BY_KENNY_ZH = new Path2D('m 5,1 v 4 h 2 v -4 z m 2,4 v 4 h 2 v -4 z m 2,0 h 2 v 14 h 2 v -4 h 6 v -2 h -6 v -4 h 6 v -2 h -6 v -2 h 6 v -2 h -8 v -2 h -2 z m -4,0 h -2 v 2 h -2 v 2 h 2 v 10 h 2 z m 22,-4 v 2 h -4 v 2 h 4 v 4 h -6 v 2 h 4 v 2 h -2 v 2 h 2 v 4 h 12 v -8 h 2 v -2 h -6 v -2 h -2 v 2 h -2 v -4 h 4 v -2 h -4 v -2 z m 6,4 v 2 h 2 v -2 z m 2,0 h 2 v -2 h -2 z m -12,10 h -2 v 2 h 2 z m 46,-14 v 6 h -4 v -4 h -2 v 4 h -2 v 2 h 2 v 10 h 2 v -2 h 10 v 2 h 2 v -10 h 2 v -2 h -8 v -2 h 6 v -2 h -6 v -2 z m 14,0 v 12 h 2 v -6 h 2 v 12 h 12 v -4 h -2 v 2 h -8 v -4 h 4 v -2 h -4 v -4 h 10 v -6 z m 10,10 h 4 v -2 h -4 z m -10,2 h -2 v 4 h 2 z m -40,-10 v 4 h 4 v -4 z m 42,0 h 12 v 2 h -12 z m -20,6 h 10 v 2 h -10 z m -38,2 h 8 v 2 h -8 z m 16,2 v 4 h 4 v -4 z m 22,0 h 10 v 2 h -10 z m -38,2 h 8 v 2 h -8 z')

      // 如何使用
      this.STATIC_PATH_HOW_TO_USE_ZH = new Path2D('m 5,1 v 4 h -4 v 2 h 2 v 4 h 2 v -4 h 2 v 8 h 2 v -10 h -2 v -4 z m 2,14 h -2 v 2 h 2 z m 0,2 v 2 h 2 v -2 z m -2,0 h -4 v 2 h 4 z m 0,-2 v -2 h -2 v 2 z m -2,-2 v -2 h -2 v 2 z m 22,-12 v 4 h 2 v -4 z m 2,4 v 10 h 6 v -10 z m -2,0 h -2 v 2 h -2 v 2 h 2 v 10 h 2 z m 4,-4 v 2 h 6 v 14 h -2 v 2 h 4 v -16 h 2 v -2 z m 16,0 v 4 h 8 v 2 h -6 v 6 h 2 v 2 h 2 v -2 h 2 v 2 h -2 v 2 h 4 v -4 h 4 v -6 h -4 v -2 h 4 v -2 h -4 v -2 h -2 v 2 h -6 v -2 z m 10,16 v 2 h 4 v -2 z m -4,0 h -4 v 2 h 4 z m -6,-12 h -2 v 2 h -2 v 2 h 2 v 10 h 2 z m 18,-4 v 16 h 2 v -4 h 4 v 6 h 2 v -6 h 6 v 4 h -2 v 2 h 4 v -18 z m 0,16 h -2 v 2 h 2 z m -52,-14 v 14 h 8 v -14 z m 54,0 h 4 v 2 h -4 z m 6,0 h 6 v 2 h -6 z m -58,2 h 4 v 10 h -4 z m 16,2 h 2 v 6 h -2 z m 36,0 h 4 v 4 h -4 z m 6,0 h 6 v 4 h -6 z m -22,2 h 4 v 2 h -4 z m 6,0 h 2 v 2 h -2 z')

      // 调整滑块来改变颜色。
      this.STATIC_PATH_INSTRUCTIONS_ZH = new Path2D('m 3,1 v 2 h 2 v -2 z m 2,2 v 2 h 2 v 10 h 2 v 4 h 6 v -6 h -6 v -2 h 8 v 8 h 2 v -18 h -12 v 2 z m 2,12 h -2 v -8 h -4 v 2 h 2 v 10 h 2 v -2 h 2 z m 18,-14 v 2 h -4 v 2 h 4 v 2 h -4 v 4 h 2 v -2 h 2 v 2 h -2 v 2 h 2 v 2 h 2 v -2 h 2 v 4 h -4 v -2 h -2 v 2 h -2 v 2 h 18 v -2 h -8 v -2 h 8 v -2 h -8 v -2 h 4 v -2 h -4 v -2 h -4 v -2 h 4 v 2 h 2 v -2 h 4 v 2 h 2 v -4 h -4 v -2 h -2 v 2 h -6 v -2 z m 12,6 h -2 v 2 h 2 z m 0,2 v 2 h 2 v -2 z m 4,-8 v 2 h 2 v -2 z m 2,2 v 2 h 2 v -2 z m 4,-2 v 6 h -2 v 2 h 12 v 2 h 2 v -4 h -4 v -2 h -4 v 2 h -2 v -4 h 6 v 2 h 2 v -4 z m 10,10 h -10 v 8 h 2 v -2 h 6 v 2 h 2 z m -12,-2 h -2 v 2 h 2 z m -2,0 v -2 h -2 v 2 z m 20,-8 v 4 h -2 v 2 h 2 v 6 h -2 v 2 h 6 v -2 h -2 v -6 h 2 v -2 h -2 v -4 z m 4,12 h 4 v 2 h 2 v -2 h 6 v -2 h -2 v -6 h -4 v -4 h -2 v 4 h -2 v 2 h 2 v 4 h -4 z m 6,2 v 2 h 2 v -2 z m 2,2 v 2 h 4 v -2 z m -4,-2 h -2 v 2 h 2 z m -2,2 h -4 v 2 h 4 z m 20,-16 v 2 h -6 v 2 h 6 v 4 h -2 v -2 h -2 v 2 h -4 v 2 h 6 v 2 h 2 v 6 h 2 v -6 h 2 v -2 h 6 v -2 h -4 v -2 h -2 v 2 h -2 v -4 h 6 v -2 h -6 v -2 z m 4,12 v 2 h 2 v -2 z m 2,2 v 2 h 2 v -2 z m 2,2 v 2 h 2 v -2 z m -10,-4 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m 26,-16 v 6 h 2 v -2 h 4 v 8 h 2 v -8 h 2 v -2 h -8 v -2 z m 6,12 h -2 v 2 h -2 v 2 h 4 z m 0,4 v 2 h 4 v -2 z m -4,0 h -4 v 2 h 4 z m -4,0 v -4 h -2 v 2 h -2 v -4 h 4 v -2 h 2 v -2 h -2 v -4 h -6 v 2 h 4 v 4 h -4 v 8 z m 6,-4 v -4 h -2 v 4 z m 16,-12 v 2 h -8 v 2 h 6 v 6 h -4 v 2 h 2 v 2 h 2 v -2 h 6 v 2 h 2 v -2 h 2 v -2 h -4 v -6 h 6 v -2 h -8 v -2 z m 8,10 h 2 v -2 h -2 z m 0,-2 v -2 h -2 v 2 z m -4,6 h -6 v 2 h 6 z m 0,2 v 2 h 6 v -2 z m -6,0 h -6 v 2 h 6 z m -4,-6 v -2 h -2 v 2 z m 0,-2 h 2 v -2 h -2 z m 22,-8 v 2 h -4 v 2 h 2 v 2 h -2 v 12 h 2 v -2 h 2 v -2 h -2 v -2 h 2 v -2 h -2 v -2 h 2 v 2 h 2 v -2 h 4 v 4 h 2 v -6 h 4 v 2 h -2 v 6 h 2 v -2 h 2 v -8 h -4 v -2 h 4 v -2 h -8 v 2 h 2 v 2 h -2 v 2 h -2 v -2 h 2 v -2 h -4 v -2 z m 12,14 v 4 h 2 v -4 z m -2,0 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,-4 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m -2,2 h -2 v 2 h 2 z m 0,-2 v -2 h -2 v 2 z m 0,-2 h 2 v -2 h -2 z m 18,-12 v 2 h 6 v 2 h -6 v -2 h -2 v 2 h -2 v 2 h 2 v 12 h 16 v -4 h -2 v 2 h -12 v -4 h 12 v -8 h -4 v -2 h 2 v -2 z m -156,2 h 2 v 2 h -2 z m 4,0 h 4 v 2 h -4 z m 116,2 h 2 v 6 h -2 z m 16,0 h 2 v 2 h -2 z m -136,2 h 2 v 2 h -2 z m 4,0 h 4 v 2 h -4 z m 60,0 h 2 v 4 h -2 z m 92,0 h 4 v 4 h -4 z m 6,0 h 4 v 4 h -4 z m -144,2 h 2 v 2 h -2 z m 156,2 v 2 h 4 v -2 z m 4,2 v 4 h 2 v -4 z m 0,4 h -4 v 2 h 4 z m -4,0 v -4 h -2 v 4 z m -134,-4 h 6 v 2 h -6 z m -38,2 h 2 v 2 h -2 z m 32,0 v 2 h 2 v -2 z m 0,2 h -2 v 2 h 2 z')
    }

    render() {
      ctx.save()
      ctx.fillStyle = 'rgb(0,0,0)'

      // 颜色测试
      ctx.translate(120, 0)
      ctx.fill(this.STATIC_PATH_COLOR_TEST_ZH)

      // 作者：肯尼·富利
      ctx.translate(0, 20)
      ctx.fill(this.STATIC_PATH_BY_KENNY_ZH)

      // 如何使用
      ctx.translate(0, 40)
      ctx.fill(this.STATIC_PATH_HOW_TO_USE_ZH)

      // 调整滑块来改变颜色。
      ctx.translate(0, 20)
      ctx.fill(this.STATIC_PATH_INSTRUCTIONS_ZH)

      ctx.restore()
    }
  }

  class TitleLogo {
    constructor() {
      this.gradientMode = {
        active: false,
        type: 'linear'
      }
      this.STATIC_PATH_SHADOW = new Path2D(`m 26,0 v 44 h -8 v 10 h 20 v -10 -44 z m 66,0 v 4 h -30 v 12 h 12 v 6 h -2 v -4 h -10 v 10 h 4 v 4 h 4 v 4 h -4 v 8 h -4 v 10 h 10 v -4 h 4 v -4 h 20 v 4 4 h 14 v -4 h 4 v -4 -10 -4 -6 h -4 v -2 -8 -12 h -8 v -4 z m -82,14 v 12 h -4 v 6 10 h 10 v -10 h 4 v -18 z m 34,0 v 14 h 4 v 14 h 10 v -14 -6 h -4 v -8 z m 50,10 h 2 v 2 h -2 z m -14,8 h 4 v 4 h -4 z m -74,34 v 4 6 h 4 v 4 h 10 v -4 -6 h -4 v -4 z m 30,0 v 4 4 h -4 v -4 h -10 v 6 4 h 4 v 2 h -20 v 10 h 8 v 2 2 6 2 h -4 v 2 2 h -4 v 6 4 h 10 v -4 h 6 v 4 h 36 v -4 -6 h -12 v -2 -4 h 2 v 4 h 10 v -4 -6 h -4 v -2 h 4 v -2 -10 h -4 v -2 h 4 v -4 -2 -4 h -10 v 4 h -2 v -4 -4 z m 44,0 v 4 h -18 v 10 14 h 10 v -14 h 2 v 6 4 6 h -4 v 10 2 10 h 36 v -10 -2 -10 h -4 v -6 -4 -6 h 2 v 14 h 10 v -14 -10 h -16 v -4 z m 2,20 h 12 v 4 h -12 z m -58,8 h 2 v 2 h -2 z m 8,8 h 4 v 4 2 h -8 v -2 h 4 z m 48,4 h 16 v 2 h -16 z`)
      this.STATIC_STRING_OUTLINE = `v 44 h -8 v 10 h 20 v -10 -44 z m 66,0 v 4 h -30 v 12 h 12 v 6 h -2 v -4 h -10 v 10 h 4 v 4 h 4 v 4 h -4 v 8 h -4 v 10 h 10 v -4 h 4 v -4 h 20 v 4 4 h 14 v -4 h 4 v -4 -10 -4 -6 h -4 v -2 -8 -12 h -8 v -4 z m -82,14 v 12 h -4 v 6 10 h 10 v -10 h 4 v -18 z m 34,0 v 14 h 4 v 14 h 10 v -14 -6 h -4 v -8 z m 50,10 h 2 v 2 h -2 z m -14,8 h 4 v 4 h -4 z m -74,34 v 4 6 h 4 v 4 h 10 v -4 -6 h -4 v -4 z m 30,0 v 4 4 h -4 v -4 h -10 v 6 4 h 4 v 2 h -20 v 10 h 8 v 2 2 6 2 h -4 v 2 2 h -4 v 6 4 h 10 v -4 h 6 v 4 h 36 v -4 -6 h -12 v -2 -4 h 2 v 4 h 10 v -4 -6 h -4 v -2 h 4 v -2 -10 h -4 v -2 h 4 v -4 -2 -4 h -10 v 4 h -2 v -4 -4 z m 44,0 v 4 h -18 v 10 14 h 10 v -14 h 2 v 6 4 6 h -4 v 10 2 10 h 36 v -10 -2 -10 h -4 v -6 -4 -6 h 2 v 14 h 10 v -14 -10 h -16 v -4 z m 2,20 h 12 v 4 h -12 z m -58,8 h 2 v 2 h -2 z m 8,8 h 4 v 4 2 h -8 v -2 h 4 z m 48,4 h 16 v 2 h -16 z`
      this.STATIC_STRING_BODY = `v 44 h -8 v 6 h 8 8 v -50 z m 66,0 v 4 h -8 v 8 20 h 6 14 v 12 h -8 v 6 h 10 v -4 h 4 v -14 -6 h -20 v -14 h 10 v 6 h -2 v -4 h -6 v 6 h 4 v 4 h 4 6 v -12 -8 h -8 v -4 z m -30,4 v 8 h 12 v 14 h -2 v -4 h -4 v -4 h -6 v 6 h 4 v 4 h 4 v 8 h -4 v 8 h -4 v 6 h 6 v -4 h 4 v -8 h 2 v 4 h 6 v -6 h -4 v -8 h 4 v -16 -8 z m -52,10 v 12 h -4 v 12 h 6 v -10 h 4 v -14 z m 34,0 v 10 h 4 v 14 h 6 v -16 h -4 v -8 z m 40,22 v 6 h 18 v -6 z m -78,30 v 6 h 4 v 4 h 6 v -6 h -4 v -4 z m 30,0 v 16 h -14 v 8 h 10 v 2 h -6 v 4 h -4 v 6 h 6 v -4 h 6 v -4 h 2 v 12 h 6 v -16 h 12 v -8 h -12 v -16 z m 44,0 v 4 h -18 v 6 14 h 6 v -14 h 36 v 14 h 6 v -14 -6 h -16 v -4 z m -58,4 v 6 h 4 v 4 h 8 v -6 h -6 v -4 z m 26,0 v 4 h -4 v 6 h 6 v -4 h 4 v -6 z m 26,8 v 4 8 4 h 24 v -4 -8 -4 z m -68,4 v 6 h 8 v 16 h -4 v 4 h -4 v 6 h 6 v -4 h 4 v -4 h 2 v 4 h 4 v 4 h 32 v -6 h -30 v -4 h -4 v -16 -6 z m 72,0 h 16 v 8 h -16 z m -34,10 v 6 h 4 v 4 h 6 v -6 h -4 v -4 z m 26,4 v 6 6 6 h 32 v -6 -6 -6 z m 6,6 h 20 v 6 h -20 z`
      this.STATIC_STRING_HIGHLIGHT = `v 2 42 h -8 v 2 4 h 2 v -4 h 6 2 v -44 h 6 v -2 z m 66,0 v 2 2 h -8 v 2 26 h 2 v -26 h 8 v -2 -2 h 4 v -2 z m -30,4 v 2 6 h 2 v -6 h 16 v -2 z m 36,0 v 2 h 8 v -2 z m -24,8 v 14 h -2 v 2 h 2 2 v -16 z m -2,16 h -2 v 8 h -4 v 2 6 h -4 v 2 4 h 2 v -4 h 2 2 v -8 h 2 2 z m 28,-16 v 6 h -2 v 2 h 2 2 v -8 z m -2,8 h -2 v 4 h 2 z m -88,-6 v 2 10 h -4 v 2 10 h 2 v -10 h 2 2 v -12 h 4 v -2 z m 34,0 v 2 8 h 2 v -8 h 4 v -2 z m 48,0 v 2 4 h 2 v -4 h 4 v -2 z m -30,4 v 2 4 h 2 v -4 h 4 v -2 z m -12,4 v 2 h 4 v -2 z m 0,2 h -2 v 14 h 2 z m 18,-2 v 2 h 4 v -2 z m 0,2 h -2 v 4 h 2 z m 22,2 v 2 h 20 v -2 z m 14,6 v 12 h -8 v 2 4 h 2 v -4 h 6 2 v -14 z m -28,4 v 2 h 4 v -2 z m 0,2 h -2 v 4 h 2 z m 8,-2 v 2 4 h 2 v -4 h 16 v -2 z m -78,30 v 2 4 h 2 v -4 h 4 v -2 z m 30,0 v 2 14 h -14 v 2 6 h 2 v -6 h 12 2 v -16 h 4 v -2 z m 44,0 v 2 2 h -18 v 2 18 h 2 v -18 h 16 2 v -4 h 12 v -2 z m -68,4 v 2 h 4 v -2 z m 0,2 h -2 v 4 h 2 z m 10,-2 v 2 4 h 2 v -4 h 4 v -2 z m 26,0 v 2 2 h -4 v 2 4 h 2 v -4 h 2 2 v -4 h 4 v -2 z m 46,0 v 2 h 16 v -2 z m -66,4 v 2 h 6 v -2 z m 0,2 h -2 v 4 h 2 z m 76,0 v 14 h 2 v -14 z m -30,2 v 2 14 h 2 v -14 h 22 v -2 z m -68,4 v 2 4 h 2 v -4 h 12 v -2 z m 36,0 v 2 h 12 v -2 z m 52,0 v 8 h -16 v 2 h 16 2 v -10 z m -80,6 v 16 h -4 v 2 2 h -4 v 2 4 h 2 v -4 h 2 2 v -4 h 2 2 v -18 z m 18,2 v 2 h 2 v -2 z m 0,2 h -6 v 2 2 h -4 v 2 4 h 2 v -4 h 2 2 v -4 h 4 z m 12,0 v 2 4 h 2 v -4 h 4 v -2 z m -8,2 v 12 h 2 v -12 z m 14,2 v 2 h 4 v -2 z m 0,2 h -2 v 4 h 2 z m 20,-2 v 2 16 h 2 v -16 h 30 v -2 z m 26,6 v 6 h -20 v 2 h 22 v -2 -6 z m -76,2 v 2 h 4 v -2 z m 0,2 h -2 v 4 h 2 z m 4,2 v 2 h 30 v -2 z m 0,2 h -2 v 4 h 2 z`
    }

    render(options) {
      const sine = options.sine
      const sine2 = options.sine2
      const moduleSets = options.colorModules
      const moduleSet0 = moduleSets[0]
      const moduleSet1 = moduleSets[1]
      const sineResult = sine(0, 4, timers.timer60 / timers.timer60max)

      const gradient = ctx.createLinearGradient(0, 0, 120, 120);
      gradient.addColorStop(0, `rgb(0,${sine2(127, 0, timers.timer60 / timers.timer60max)},0)`)
      gradient.addColorStop(1, `rgb(0,${sine2(127, 255, timers.timer60 / timers.timer60max)},0)`)

      ctx.fillStyle = `rgb(${moduleSet1.r},${moduleSet1.g},${moduleSet1.b})`
      ctx.fill(this.STATIC_PATH_SHADOW)
      ctx.fill(new Path2D(`m ${22 + sineResult},0 ` + this.STATIC_STRING_OUTLINE))
      ctx.fillStyle = this.gradientMode.active ? gradient : `rgb(${moduleSet0.r},${moduleSet0.g},${moduleSet0.b})`
      ctx.fill(new Path2D(`m ${24 + sineResult},2 ` + this.STATIC_STRING_BODY))
      ctx.fillStyle = 'rgb(255,255,255)'
      ctx.fill(new Path2D(`m ${24 + sineResult},2 ` + this.STATIC_STRING_HIGHLIGHT))
    }

    update() {
      if (
        digiPointer.pos.dx >= 0 &&
        digiPointer.pos.dx < 120 &&
        digiPointer.pos.dy >= 0 &&
        digiPointer.pos.dy < 120 &&
        digiPointer.pos.isTouching
      ) {
        this.gradientMode.active = !this.gradientMode.active
      }
    }
  }

  class Scene {
    constructor() {
      this.utilFunctions = new UtilFunctions()
      this.titleLogo = new TitleLogo()
      this.howToUseMsg = new HowToUseMsg()

      this.colorModules = [
        new ColorModule({id: 0, r: 255, g: 171, b: 145}),
        new ColorModule({id: 1, r: 191, g: 54, b: 12}),
      ]

      this.colorSliders = []

      for (let i = 0; i < 6; i++) this.colorSliders.push(new ColorSlider({id: i}))

      this.render()
    }

    render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height)
      this.titleLogo.render({colorModules: this.colorModules, sine: this.utilFunctions.sine, sine2: this.utilFunctions.sine2})
      this.howToUseMsg.render()
      this.colorModules.forEach(module => module.render({sine: this.utilFunctions.sine}))
      this.colorSliders.forEach(slider => slider.render({colorModules: this.colorModules, sine: this.utilFunctions.sine}))
      digiPointer.render()
      this.update()
    }


    update() {
      this.colorSliders.forEach(slider => slider.update({colorModules: this.colorModules}))
      this.titleLogo.update()

      if (timers.timer60 >= timers.timer60max) {
        timers.timer60 = 0
      } else {
        timers.timer60++
      }

      requestAnimationFrame(() => this.render())
    }
  }

  class UtilFunctions {
    sine = (a, b, t) => {
      t = Math.min(Math.max(t, 0), 1); // Clamp between 0 and 1
      const index = Math.floor(t * (pixelSteps.length - 1)); // Ensure index is in bounds
      return pixelSteps[index];
    }

    sine2 = (a, b, t) => {
      return a + (b - a) * (Math.sin(Math.PI * (t * 2)))
    }
  }

  const digiPointer = new DigiPointer()
  const scene = new Scene()

  // SECURITY FIX
  function updatePointerPosition(e) {
    e.preventDefault();
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;

    const rawX = (e.clientX - rect.left) * scaleX;
    const rawY = (e.clientY - rect.top) * scaleY;

    // SECURITY FIX
    digiPointer.pos.dx = Math.floor(Math.max(0, Math.min(rawX, canvas.width - 1)));
    digiPointer.pos.dy = Math.floor(Math.max(0, Math.min(rawY, canvas.height - 1)));
  }

  canvas.addEventListener('pointerdown', (e) => {
    digiPointer.pos.isTouching = true;
    updatePointerPosition(e);
  });

  canvas.addEventListener('pointermove', (e) => {
    if (digiPointer.pos.isTouching) {
        updatePointerPosition(e);
    }
  });

  function clearPointerState(e) {
    e.preventDefault();
    digiPointer.pos.isTouching = false;
    digiPointer.pos.dx = null;
    digiPointer.pos.dy = null;
  }
  // No use,so remove
  canvas.addEventListener('pointerup', clearPointerState);
  canvas.addEventListener('pointercancel', clearPointerState);
  canvas.addEventListener('pointerout', clearPointerState);
</script>

</html>
